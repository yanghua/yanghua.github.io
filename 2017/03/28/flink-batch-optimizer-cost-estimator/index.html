<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="google-site-verification" content="6q22x_DFglYGJjD5t1d95nBYd_U8cDU04B-Haky8KHs" />
  <meta name="baidu-site-verification" content="yEdVDDBr1C" />
  
  <title>Flink批处理优化器之成本估算 | yanghua</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="成本估算在基于成本的优化器中，成本估算非常重要，它直接影响着候选计划的生成。在Flink中成本估算依赖于每个不同的运算符所提供的自己的“预算”，本篇我们将分析什么是成本、运算符如何提供自己的预算以及如何基于预算估算成本。">
<meta property="og:type" content="article">
<meta property="og:title" content="Flink批处理优化器之成本估算">
<meta property="og:url" content="http://vinoyang.com/2017/03/28/flink-batch-optimizer-cost-estimator/index.html">
<meta property="og:site_name" content="yanghua">
<meta property="og:description" content="成本估算在基于成本的优化器中，成本估算非常重要，它直接影响着候选计划的生成。在Flink中成本估算依赖于每个不同的运算符所提供的自己的“预算”，本篇我们将分析什么是成本、运算符如何提供自己的预算以及如何基于预算估算成本。">
<meta property="og:image" content="http://7xkaaz.com1.z0.glb.clouddn.com/EstimateProvider-class-diagram.png">
<meta property="og:image" content="http://7xkaaz.com1.z0.glb.clouddn.com/Apache_Flink_weixin.jpg">
<meta property="og:image" content="http://7xkaaz.com1.z0.glb.clouddn.com/qrcode_for_apache_flink_qq_group.png">
<meta property="og:updated_time" content="2017-03-28T14:53:32.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Flink批处理优化器之成本估算">
<meta name="twitter:description" content="成本估算在基于成本的优化器中，成本估算非常重要，它直接影响着候选计划的生成。在Flink中成本估算依赖于每个不同的运算符所提供的自己的“预算”，本篇我们将分析什么是成本、运算符如何提供自己的预算以及如何基于预算估算成本。">
<meta name="twitter:image" content="http://7xkaaz.com1.z0.glb.clouddn.com/EstimateProvider-class-diagram.png">
  
    <link rel="alternative" href="/atom.xml" title="yanghua" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="/css/style.css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">yanghua</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">alone coder</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/projects">Projects</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-github-link" class="nav-icon" href="https://github.com/yanghua" target="_blank" title="GitHub"></a>
        
        
          <a id="nav-weibo-link" class="nav-icon" href="http://weibo.com/yanghua1127" target="_blank" title="Sina Weibo"></a>
        
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://vinoyang.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-flink-batch-optimizer-cost-estimator" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/28/flink-batch-optimizer-cost-estimator/" class="article-date">
  <time datetime="2017-03-28T14:45:46.000Z" itemprop="datePublished">2017-03-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Flink批处理优化器之成本估算
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
          <div id="toc" class="toc-article">
            <strong class="toc-title">文章目录</strong>
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#成本估算"><span class="toc-number">1.</span> <span class="toc-text">成本估算</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是成本"><span class="toc-number">1.1.</span> <span class="toc-text">什么是成本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何估算成本"><span class="toc-number">1.2.</span> <span class="toc-text">如何估算成本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#预算提供者"><span class="toc-number">1.3.</span> <span class="toc-text">预算提供者</span></a></li></ol></li></ol>
          </div>
        
        <h1 id="成本估算"><a href="#成本估算" class="headerlink" title="成本估算"></a>成本估算</h1><p>在基于成本的优化器中，成本估算非常重要，它直接影响着候选计划的生成。在Flink中成本估算依赖于每个不同的运算符所提供的自己的“预算”，本篇我们将分析什么是成本、运算符如何提供自己的预算以及如何基于预算估算成本。</p>
<a id="more"></a>
<h2 id="什么是成本"><a href="#什么是成本" class="headerlink" title="什么是成本"></a>什么是成本</h2><p>Flink以类Costs来定义成本，它封装了一些成本估算的因素同时提供了一些针对成本对象的计算方法（加、减、乘、除）以及对这些因素未知值的认定与校验。</p>
<blockquote>
<p>“cost”一词也有译作：开销、代价，将其视为同义即可。</p>
</blockquote>
<p>Flink当前将成本估算的因素划分为两大类：</p>
<ul>
<li>可量化的成本估算因素：指代通过跟踪一个可量化的测量指标可以计算出的成本估算因素（比如网络或I/O的字节数）；</li>
<li>启发式的成本估算因素：指代那些不可定量计算的成本估算因素，因此只能给出一些定性的经验值；</li>
</ul>
<p>当前被纳入成本估算的因素如下：</p>
<ul>
<li>网络成本；</li>
<li>磁盘I/O成本；</li>
<li>CPU成本；</li>
<li>启发式网络成本；</li>
<li>启发式磁盘成本；</li>
<li>启发式CPU成本；</li>
</ul>
<p>可量化的成本估算因素可能经常会被设置为未知的（UNKNOWN，在Costs中以字面常量值-1表示）。当可量化的成本估算因素被置为未知时，所有操作的成本都将变成未知的，因此这将导致在进行优化裁剪期间，无法决策出哪个偏向的操作。在这种情况下，启发式的成本估算因素必须能发挥作用，它应该包含一个值来确保以不同策略执行的运算符是可比较的（甚至在无法估算的情况下）。</p>
<h2 id="如何估算成本"><a href="#如何估算成本" class="headerlink" title="如何估算成本"></a>如何估算成本</h2><p>成本的估算借助于成本估算器（CostEstimator），CostEstimator定义了一系列增加成本的方法，这些方法有待具体的估算器实现，它们大致分为三大类：</p>
<ul>
<li>增加传输策略的成本；</li>
<li>增加本地策略的成本；</li>
<li>增加屏障的成本；</li>
</ul>
<p>CostEstimator借助于以上这几类方法，可完成对一个运算符总成本的计算，具体的计算逻辑封装在方法costOperator中，该方法接收一个计划节点（PlanNode）参数，然后按照传输策略和本地策略分别进行枚举与计算。完整的方法如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> costOperator(PlanNode n) &#123;</div><div class="line">    <span class="comment">//构建一个成本对象用来存储总成本</span></div><div class="line">    <span class="keyword">final</span> Costs totalCosts = <span class="keyword">new</span> Costs();</div><div class="line">    <span class="comment">//获得该节点的最少可用内存</span></div><div class="line">    <span class="keyword">final</span> <span class="keyword">long</span> availableMemory = n.getGuaranteedAvailableMemory();</div><div class="line"></div><div class="line">    <span class="comment">//-----------------------------</span></div><div class="line">    <span class="comment">// 增加传输策略产生的成本</span></div><div class="line">    <span class="comment">//-----------------------------</span></div><div class="line"></div><div class="line">    <span class="comment">//遍历该节点的所有输入端通道    </span></div><div class="line">    <span class="keyword">for</span> (Channel <span class="string">channel :</span> n.getInputs()) &#123;</div><div class="line">        <span class="keyword">final</span> Costs costs = <span class="keyword">new</span> Costs();</div><div class="line"></div><div class="line">        <span class="comment">//匹配当前通道的传输策略</span></div><div class="line">        <span class="keyword">switch</span> (channel.getShipStrategy()) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="string">NONE:</span></div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> CompilerException(</div><div class="line">                    <span class="string">"Cannot determine costs: Shipping strategy has not been set for an input."</span>);</div><div class="line">            <span class="keyword">case</span> <span class="string">FORWARD:</span></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="comment">//随机重分区</span></div><div class="line">            <span class="keyword">case</span> <span class="string">PARTITION_RANDOM:</span>    </div><div class="line">                addRandomPartitioningCost(channel, costs);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="comment">//哈希分区与自定义分区增加成本的方式相同</span></div><div class="line">            <span class="keyword">case</span> <span class="string">PARTITION_HASH:</span></div><div class="line">            <span class="keyword">case</span> <span class="string">PARTITION_CUSTOM:</span></div><div class="line">                addHashPartitioningCost(channel, costs);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="comment">//范围分区</span></div><div class="line">            <span class="keyword">case</span> <span class="string">PARTITION_RANGE:</span>    </div><div class="line">                addRangePartitionCost(channel, costs);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="comment">//广播</span></div><div class="line">            <span class="keyword">case</span> <span class="string">BROADCAST:</span></div><div class="line">                addBroadcastCost(channel, channel.getReplicationFactor(), costs);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="comment">//强制重平衡分区</span></div><div class="line">            <span class="keyword">case</span> <span class="string">PARTITION_FORCED_REBALANCE:</span></div><div class="line">                addRandomPartitioningCost(channel, costs);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line"><span class="symbol">            default:</span></div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> CompilerException(<span class="string">"Unknown shipping strategy for input: "</span> </div><div class="line">                    + channel.getShipStrategy());</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//匹配当前通道的本地策略</span></div><div class="line">        <span class="keyword">switch</span> (channel.getLocalStrategy()) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="string">NONE:</span></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="comment">//排序与合并排序都增加本地的排序成本</span></div><div class="line">            <span class="keyword">case</span> <span class="string">SORT:</span></div><div class="line">            <span class="keyword">case</span> <span class="string">COMBININGSORT:</span></div><div class="line">                addLocalSortCost(channel, costs);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line"><span class="symbol">            default:</span></div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> CompilerException(<span class="string">"Unsupported local strategy for input: "</span> </div><div class="line">                    + channel.getLocalStrategy());</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//增加屏障成本</span></div><div class="line">        <span class="keyword">if</span> (channel.getTempMode() != <span class="literal">null</span> &amp;&amp; channel.getTempMode() != TempMode.NONE) &#123;</div><div class="line">            addArtificialDamCost(channel, <span class="number">0</span>, costs);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//如果通道在动态路径上，则需要调整成本计算的权重</span></div><div class="line">        <span class="keyword">if</span> (channel.isOnDynamicPath()) &#123;</div><div class="line">            costs.multiplyWith(channel.getCostWeight());</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//将当前通道的成本加入总成本</span></div><div class="line">        totalCosts.addCosts(costs);</div><div class="line">    &#125; </div><div class="line"></div><div class="line">    Channel firstInput = <span class="literal">null</span>;</div><div class="line">    Channel secondInput = <span class="literal">null</span>;</div><div class="line">    Costs driverCosts = <span class="keyword">new</span> Costs();</div><div class="line">    <span class="keyword">int</span> costWeight = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="comment">//如果节点在动态路径上，则重新调整成本权重</span></div><div class="line">    <span class="keyword">if</span> (n.isOnDynamicPath()) &#123;</div><div class="line">        costWeight = n.getCostWeight();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//获得当前节点的所有输入端通道</span></div><div class="line">    &#123;</div><div class="line">        Iterator&lt;Channel&gt; channels = n.getInputs().iterator();</div><div class="line">        <span class="keyword">if</span> (channels.hasNext()) &#123;</div><div class="line">            firstInput = channels.next();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (channels.hasNext()) &#123;</div><div class="line">            secondInput = channels.next();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//根据计划节点的执行策略来计算本地成本</span></div><div class="line">    <span class="keyword">switch</span> (n.getDriverStrategy()) &#123;</div><div class="line">        <span class="comment">//以下这些执行策略不计算本地成本</span></div><div class="line">        <span class="keyword">case</span> <span class="string">NONE:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">UNARY_NO_OP:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">BINARY_NO_OP:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">MAP:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">MAP_PARTITION:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">FLAT_MAP:</span></div><div class="line"></div><div class="line">        <span class="keyword">case</span> <span class="string">ALL_GROUP_REDUCE:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">ALL_REDUCE:</span></div><div class="line"></div><div class="line">        <span class="keyword">case</span> <span class="string">CO_GROUP:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">CO_GROUP_RAW:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">SORTED_GROUP_REDUCE:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">SORTED_REDUCE:</span></div><div class="line"></div><div class="line">        <span class="keyword">case</span> <span class="string">SORTED_GROUP_COMBINE:</span></div><div class="line"></div><div class="line">        <span class="keyword">case</span> <span class="string">ALL_GROUP_COMBINE:</span></div><div class="line"></div><div class="line">        <span class="keyword">case</span> <span class="string">UNION:</span></div><div class="line"></div><div class="line">            <span class="keyword">break</span>;</div><div class="line"></div><div class="line">        <span class="comment">//各种形式的合并成本</span></div><div class="line">        <span class="keyword">case</span> <span class="string">INNER_MERGE:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">FULL_OUTER_MERGE:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">LEFT_OUTER_MERGE:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">RIGHT_OUTER_MERGE:</span></div><div class="line">            addLocalMergeCost(firstInput, secondInput, driverCosts, costWeight);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line"></div><div class="line">        <span class="comment">//混合哈希join的成本(第一个输入边是构建边，第二个输入边是扫描边)</span></div><div class="line">        <span class="keyword">case</span> <span class="string">HYBRIDHASH_BUILD_FIRST:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">RIGHT_HYBRIDHASH_BUILD_FIRST:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">LEFT_HYBRIDHASH_BUILD_FIRST:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">FULL_OUTER_HYBRIDHASH_BUILD_FIRST:</span></div><div class="line">            addHybridHashCosts(firstInput, secondInput, driverCosts, costWeight);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line"></div><div class="line">        <span class="comment">//混合哈希join的成本（第二个输入边是构建边，第一个输入边是扫描边）</span></div><div class="line">        <span class="keyword">case</span> <span class="string">HYBRIDHASH_BUILD_SECOND:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">LEFT_HYBRIDHASH_BUILD_SECOND:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">RIGHT_HYBRIDHASH_BUILD_SECOND:</span></div><div class="line">        <span class="keyword">case</span> <span class="string">FULL_OUTER_HYBRIDHASH_BUILD_SECOND:</span></div><div class="line">            addHybridHashCosts(secondInput, firstInput, driverCosts, costWeight);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line"></div><div class="line">        <span class="comment">//各种其他的执行策略</span></div><div class="line">        <span class="keyword">case</span> <span class="string">HYBRIDHASH_BUILD_FIRST_CACHED:</span></div><div class="line">            addCachedHybridHashCosts(firstInput, secondInput, driverCosts, costWeight);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">HYBRIDHASH_BUILD_SECOND_CACHED:</span></div><div class="line">            addCachedHybridHashCosts(secondInput, firstInput, driverCosts, costWeight);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">NESTEDLOOP_BLOCKED_OUTER_FIRST:</span></div><div class="line">            addBlockNestedLoopsCosts(firstInput, secondInput, availableMemory, driverCosts, costWeight);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">NESTEDLOOP_BLOCKED_OUTER_SECOND:</span></div><div class="line">            addBlockNestedLoopsCosts(secondInput, firstInput, availableMemory, driverCosts, costWeight);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">NESTEDLOOP_STREAMED_OUTER_FIRST:</span></div><div class="line">            addStreamedNestedLoopsCosts(firstInput, secondInput, availableMemory, driverCosts, costWeight);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">NESTEDLOOP_STREAMED_OUTER_SECOND:</span></div><div class="line">            addStreamedNestedLoopsCosts(secondInput, firstInput, availableMemory, driverCosts, costWeight);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line"><span class="symbol">        default:</span></div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> CompilerException(<span class="string">"Unknown local strategy: "</span> + n.getDriverStrategy().name());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//将驱动器的执行成本加入到总成本，将得到的总成本作为当前节点的成本</span></div><div class="line">    totalCosts.addCosts(driverCosts);</div><div class="line">    n.setCosts(totalCosts);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>DefaultCostEstimator继承自CostEstimator，作为默认的（也是唯一的）成本估算器。它实现了上面计算成本逻辑中调用的一系列增加成本的addXXX方法。这些方法中的绝大部分，又依赖于预算提供器（EstimateProvider）所提供的预算数据，然后根据不同的增加成本的算法逻辑，利用这些预算数据做计算。比如我们以新增广播成本的addBroadcastCost方法为示例，其实广播传输方式说白了就是将数据复制到当前运算符的所有输出通道中，因此这里对成本的计算取决于复制因子，代码如下：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">addBroadcastCost</span><span class="params">(EstimateProvider estimates, <span class="keyword">int</span> replicationFactor, Costs costs)</span> </span>&#123;</div><div class="line">    <span class="comment">//检查复制因子的合法性</span></div><div class="line">    <span class="keyword">if</span> (replicationFactor &lt;= <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"The replication factor of must be larger than zero."</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (replicationFactor &gt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">//所估算的需要输出数据的大小</span></div><div class="line">        <span class="keyword">final</span> <span class="keyword">long</span> estOutShipSize = estimates.getEstimatedOutputSize();</div><div class="line">        <span class="comment">//如果数据大小小于等于零，则标记网络成本为“未知”</span></div><div class="line">        <span class="keyword">if</span> (estOutShipSize &lt;= <span class="number">0</span>) &#123;</div><div class="line">            costs.setNetworkCost(Costs.UNKNOWN);</div><div class="line">        &#125; </div><div class="line">        <span class="comment">//否则网络成本拿数据大小乘以复制因子</span></div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            costs.addNetworkCost(replicationFactor * estOutShipSize);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//增加启发式网络成本，通过启发式成本基数乘以复制因子后再扩大十倍</span></div><div class="line">        costs.addHeuristicNetworkCost(HEURISTIC_COST_BASE * <span class="number">10</span> * replicationFactor);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        costs.addHeuristicNetworkCost(HEURISTIC_COST_BASE * <span class="number">1000</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="预算提供者"><a href="#预算提供者" class="headerlink" title="预算提供者"></a>预算提供者</h2><p>前面我们谈论了如何通过CostEstimator来估算成本，但其实CostEstimator是在已获得预算数据的基础上应用相关的算法来算出成本的，而用来估算成本的预算数据其实是来自预算提供者（EstimateProvider）。Flink批处理中所有的运算符都有一个基于优化器的内部表示，我们可以称它们为优化器运算符，这些运算符创建于优化操作之前，且它们都必须实现EstimateProvider接口。各个优化器运算符根据自己的实现以及语义将成本估算相关的信息暴露给外部查询。目前被纳入预算的信息有：</p>
<ul>
<li>输出的数据流大小：由接口方法getEstimatedOutputSize提供；</li>
<li>输出的记录数：由接口方法getEstimatedNumRecords提供；</li>
<li>单个输出记录的平均字节数：由接口方法getEstimatedAvgWidthPerOutputRecord提供；</li>
</ul>
<p>在dag包下，EstimateProvider接口的继承关系图如下：</p>
<p><img src="http://7xkaaz.com1.z0.glb.clouddn.com/EstimateProvider-class-diagram.png" alt="EstimateProvider"></p>
<p>其中，OptimizerNode是所有被优化的运算符继承的基类，因此所有优化器运算符都是预算提供者。OptimizerNode为绝大部分的优化器运算符提供了统一的预算计算方法computeOutputEstimates。</p>
<blockquote>
<p>为什么说是绝大部分运算符呢？因为有些运算符是特殊的，比如双输入端union运算符BinaryUnionNode以及迭代相关的运算符。</p>
</blockquote>
<p>所有的运算符都会在优化时被遍历，Flink提供了一个编号及预算遍历器（IdAndEstimatesVisitor）来对所有运算符进行逐个遍历并计算预算，这一点体现在Optimizer的compile方法的下面这行代码中：</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rootNode.accept(<span class="keyword">new</span> <span class="type">IdAndEstimatesVisitor</span>(<span class="built_in">this</span>.statistics));</div></pre></td></tr></table></figure>
<p>而在IdAndEstimatesVisitor的postVisit方法中即调用computeOutputEstimates方法来计算预算。下面，我们来分析一下预算是如何计算得出的，总得来说computeOutputEstimates的逻辑被分为两部分：</p>
<ul>
<li>各个具体的运算符计算它们特定的预算；</li>
<li>根据编译提示（CompilerHints）覆盖原有的预算计算；</li>
</ul>
<p>OptimizerNode将特定运算符的预算计算定义成名为computeOperatorSpecificDefaultEstimates的抽象方法开放给派生类根据自身的特定逻辑实现。然后，如果该运算符如果设置有CompilerHints的话，将会根据CompilerHints覆盖原有的预算结果。</p>
<blockquote>
<p>所谓CompilerHints，它是封装了描述用户函数行为的编译提示，它可用于改进优化器对计划的选择。如果给某个运算符设置编译提示的话，那么在计算预算时，将会用它来覆盖运算符自身给出的中间结果的预算。当前，CompilerHints在优化器中没有得到太大的机会发挥。</p>
</blockquote>
<p>因为CompilerHints没有被广泛应用，所以预算的计算还是依赖各个运算符具体提供，所以我们关注一下computeOperatorSpecificDefaultEstimates方法。该方法完全是按照具体运算符的语义特征来实现的，我们选择看其中的几个实现：</p>
<p>二元union运算符的预算就是累加其两个输入端：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> computeOperatorSpecificDefaultEstimates(DataStatistics statistics) &#123;</div><div class="line">    <span class="keyword">long</span> card1 = getFirstPredecessorNode().getEstimatedNumRecords();</div><div class="line">    <span class="keyword">long</span> card2 = getSecondPredecessorNode().getEstimatedNumRecords();</div><div class="line">    <span class="keyword">this</span>.estimatedNumRecords = (card1 &lt; <span class="number">0</span> || card2 &lt; <span class="number">0</span>) ? -1 : card1 + card2;</div><div class="line"></div><div class="line">    <span class="keyword">long</span> size1 = getFirstPredecessorNode().getEstimatedOutputSize();</div><div class="line">    <span class="keyword">long</span> size2 = getSecondPredecessorNode().getEstimatedOutputSize();</div><div class="line">    <span class="keyword">this</span>.estimatedOutputSize = (size1 &lt; <span class="number">0</span> || size2 &lt; <span class="number">0</span>) ? -1 : size1 + size2;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Cross运算符的处理方式是：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> computeOperatorSpecificDefaultEstimates(DataStatistics statistics) &#123;</div><div class="line">    <span class="keyword">long</span> card1 = getFirstPredecessorNode().getEstimatedNumRecords();</div><div class="line">    <span class="keyword">long</span> card2 = getSecondPredecessorNode().getEstimatedNumRecords();</div><div class="line">    <span class="comment">//输出的总记录数为第一个输入节点和第二个输入节点的记录数的乘积；</span></div><div class="line">    <span class="keyword">this</span>.estimatedNumRecords = (card1 &lt; <span class="number">0</span> || card2 &lt; <span class="number">0</span>) ? <span class="number">-1</span> : card1 * card2;</div><div class="line"></div><div class="line">    <span class="comment">//如果记录数大于等于零，则会计算输出数据的大小</span></div><div class="line">    <span class="built_in">if</span> (<span class="keyword">this</span>.estimatedNumRecords &gt;= <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">//获得第一个、第二个输入节点的单条记录大小，两者相加则是cross运算符单条输出记录的大小</span></div><div class="line">        <span class="keyword">float</span> width1 = getFirstPredecessorNode().getEstimatedAvgWidthPerOutputRecord();</div><div class="line">        <span class="keyword">float</span> width2 = getSecondPredecessorNode().getEstimatedAvgWidthPerOutputRecord();</div><div class="line">        <span class="keyword">float</span> <span class="built_in">width</span> = (width1 &lt;= <span class="number">0</span> || width2 &lt;= <span class="number">0</span>) ? <span class="number">-1</span> : width1 + width2;</div><div class="line"></div><div class="line">        <span class="built_in">if</span> (<span class="built_in">width</span> &gt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">this</span>.estimatedOutputSize = (<span class="keyword">long</span>) (<span class="built_in">width</span> * <span class="keyword">this</span>.estimatedNumRecords);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从上面的两个运算符对预算的计算可见，它们大都依赖上游运算符的输出预算。而最初的预算肯定由source运算符决定，因为只有source才能知道数据的具体规模。</p>
<p>所以，我们来看一下DataSourceNode，很明显它作为数据的输入源，是最有可能了解初始数据集大小的运算符，为此Flink定义了一个专门用于统计的对象BaseStatistics，它用于统计对接外部的数据源的预算信息。但并非每个数据源的信息都能被统计到，而Flink当前也只实现了以文件为输入的FileInputFormat的预算统计FileBaseStatistics。</p>
<hr>
<blockquote>
<p>微信扫码关注公众号：Apache_Flink</p>
</blockquote>
<p><img src="http://7xkaaz.com1.z0.glb.clouddn.com/Apache_Flink_weixin.jpg" alt="apache_flink_weichat"></p>
<hr>
<blockquote>
<p>QQ扫码关注QQ群：Apache Flink学习交流群（123414680）</p>
</blockquote>
<p><img src="http://7xkaaz.com1.z0.glb.clouddn.com/qrcode_for_apache_flink_qq_group.png" alt="qrcode_for_apache_flink_qq_group"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://vinoyang.com/2017/03/28/flink-batch-optimizer-cost-estimator/" data-id="cj52j6msu0026kwvuo7cmp7ue" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Flink/">Flink</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/03/31/flink-runtime-client-submit-jobgraph/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Flink运行时之客户端提交作业图-上
        
      </div>
    </a>
  
  
    <a href="/2017/03/16/flink-cep-pattern-stream-and-operator/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Flink-CEP之模式流与运算符</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-flink-batch-optimizer-cost-estimator" data-title="Flink批处理优化器之成本估算" data-url="http://vinoyang.com/2017/03/28/flink-batch-optimizer-cost-estimator/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'vinoyang'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Akka/">Akka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flink/">Flink</a><span class="tag-list-count">62</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RabbitMQ/">RabbitMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zookeeper/">Zookeeper</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/async/">async</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/disque/">disque</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flume/">flume</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/messagebus/">messagebus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/morphline/">morphline</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/quartz/">quartz</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rate-limit/">rate-limit</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式/">分布式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式锁/">分布式锁</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/日志系统/">日志系统</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/消息总线/">消息总线</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Akka/" style="font-size: 10px;">Akka</a> <a href="/tags/Flink/" style="font-size: 20px;">Flink</a> <a href="/tags/RabbitMQ/" style="font-size: 10px;">RabbitMQ</a> <a href="/tags/Zookeeper/" style="font-size: 12.5px;">Zookeeper</a> <a href="/tags/async/" style="font-size: 10px;">async</a> <a href="/tags/disque/" style="font-size: 10px;">disque</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/flume/" style="font-size: 15px;">flume</a> <a href="/tags/messagebus/" style="font-size: 10px;">messagebus</a> <a href="/tags/morphline/" style="font-size: 10px;">morphline</a> <a href="/tags/quartz/" style="font-size: 10px;">quartz</a> <a href="/tags/rate-limit/" style="font-size: 10px;">rate-limit</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/分布式/" style="font-size: 10px;">分布式</a> <a href="/tags/分布式锁/" style="font-size: 10px;">分布式锁</a> <a href="/tags/日志系统/" style="font-size: 17.5px;">日志系统</a> <a href="/tags/消息总线/" style="font-size: 15px;">消息总线</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">二月 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">一月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">十月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">九月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">六月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">四月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">三月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">二月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">十二月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">十月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">九月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">七月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">五月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">三月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">二月 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">一月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">十二月 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">十一月 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09/">九月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">八月 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">六月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">五月 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">四月 2012</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">三月 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">二月 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/01/">一月 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/12/">十二月 2011</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/11/">十一月 2011</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">十月 2011</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">九月 2011</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/08/">八月 2011</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/07/">七月 2011</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/06/">六月 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">五月 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/03/">三月 2011</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/02/">二月 2011</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/07/">七月 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/06/">六月 2010</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/05/">五月 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">四月 2010</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">三月 2010</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/02/">二月 2010</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/01/">一月 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/10/">十月 2009</a><span class="archive-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/07/13/flink-relation-api-common-part/">Flink关系型API的公共部分</a>
          </li>
        
          <li>
            <a href="/2017/07/06/flink-relation-api-introduction/">Flink-关系型API简介</a>
          </li>
        
          <li>
            <a href="/2017/06/13/flink-batch-delta-iteration/">Flink批处理中的增量迭代</a>
          </li>
        
          <li>
            <a href="/2017/06/12/flink-table-sql-source/">Flink-Table-SQL系列之source</a>
          </li>
        
          <li>
            <a href="/2017/04/24/flink-batch-optimizer-join-optimize/">浅谈Flink批处理优化器之Join优化</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Weibo show</h3>
    <div class="widget-weibo">
      <iframe width="100%" height="450" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=2&isTitle=0&noborder=0&isWeibo=1&isFans=0&uid=1958166695&verifier=9c2d28b9&colors=dddddd,dddddd,666666,0069a4,dddddd&dpc=1"></iframe>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Github</h3>
    <div class="widget-github">
      <script data-name="yanghua" src="http://octocard.in/o.js"></script>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 yanghua1127@gmail.com<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/projects" class="mobile-nav-link">Projects</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="http://apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>
<script type="text/javascript">
//<![CDATA[
if (typeof jQuery == 'undefined') {
  document.write(unescape("%3Cscript src='/js/jquery-2.0.3.min.js' type='text/javascript'%3E%3C/script%3E"));
}
// ]]>
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?36c1573c11e45ea0f6419af5f2f04760";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
  </div>
</body>
</html>